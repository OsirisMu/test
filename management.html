<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>话术管理 - 损失厌恶营销话术系统</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.4.3/echarts.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@splidejs/splide@4.1.4/dist/js/splide.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/@splidejs/splide@4.1.4/dist/css/splide.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;700&family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans SC', sans-serif;
            background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
        }
        .hero-title {
            font-family: 'Noto Serif SC', serif;
            background: linear-gradient(135deg, #1e3a8a, #f97316);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        .dialogue-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .editing {
            border: 2px solid #f97316;
            background: rgba(249, 115, 22, 0.05);
        }
        .edit-mode {
            background: linear-gradient(135deg, #1e3a8a, #3b82f6);
            color: white;
        }
        .preview-mode {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }
        .import-export-btn {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            color: white;
        }
        .save-btn {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }
        .cancel-btn {
            background: linear-gradient(135deg, #6b7280, #4b5563);
            color: white;
        }
        .dialogue-item {
            transition: all 0.3s ease;
        }
        .dialogue-item:hover {
            transform: translateX(4px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .search-highlight {
            background: rgba(249, 115, 22, 0.3);
            padding: 2px 4px;
            border-radius: 4px;
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- Navigation -->
    <nav class="bg-white/80 backdrop-blur-md border-b border-gray-200/50 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center space-x-2">
                    <div class="w-8 h-8 bg-gradient-to-br from-blue-600 to-orange-500 rounded-lg flex items-center justify-center">
                        <span class="text-white font-bold text-sm">新奥</span>
                    </div>
                    <span class="text-xl font-bold text-gray-900">商呼三部—损失厌恶话术库</span>
                </div>
                <div class="hidden md:flex space-x-8">
                    <a href="index.html" class="text-gray-600 hover:text-blue-600 transition-colors">首页</a>
                    <a href="dialogue-library.html" class="text-gray-600 hover:text-blue-600 transition-colors">话术库</a>
                    <a href="practice-system.html" class="text-gray-600 hover:text-blue-600 transition-colors">练习系统</a>
                    <a href="management.html" class="text-blue-600 font-medium border-b-2 border-blue-600 pb-1">话术管理</a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Header -->
    <section class="py-16 px-4 sm:px-6 lg:px-8">
        <div class="max-w-7xl mx-auto text-center">
            <h1 class="hero-title text-4xl md:text-6xl font-bold mb-6">话术管理系统</h1>
            <p class="text-xl text-gray-600 mb-8 max-w-3xl mx-auto">
                强大的话术管理工具，支持实时编辑、批量导入导出，让您的销售话术库始终保持最佳状态
            </p>
        </div>
    </section>

    <!-- Management Tools -->
    <section class="px-4 sm:px-6 lg:px-8 mb-12">
        <div class="max-w-7xl mx-auto">
            <!-- Control Panel -->
            <div class="dialogue-card rounded-2xl p-6 mb-8">
                <div class="flex flex-wrap items-center justify-between gap-4 mb-6">
                    <div class="flex items-center space-x-4">
                        <h2 class="text-2xl font-bold text-gray-900">话术管理控制台</h2>
                        <div class="flex items-center space-x-2">
                            <button id="edit-mode-btn" onclick="toggleEditMode()" class="edit-mode px-4 py-2 rounded-lg font-medium transition-all duration-300">
                                编辑模式
                            </button>
                            <button id="preview-mode-btn" onclick="togglePreviewMode()" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-medium transition-all duration-300">
                                预览模式
                            </button>
                        </div>
                    </div>
                    
                    <div class="flex items-center space-x-3">
                        <!-- Search -->
                        <div class="relative">
                            <input type="text" id="search-input" placeholder="搜索话术..." class="pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <svg class="w-5 h-5 text-gray-400 absolute left-3 top-2.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                            </svg>
                        </div>
                        
                        <!-- Import/Export -->
                        <button onclick="showImportExportModal()" class="import-export-btn px-4 py-2 rounded-lg font-medium transition-all duration-300">
                            导入/导出
                        </button>
                        
                        <!-- Add New -->
                        <button onclick="showAddDialogueModal()" class="bg-gradient-to-r from-blue-600 to-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-all duration-300">
                            添加话术
                        </button>
                    </div>
                </div>

                <!-- Stats -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <div class="text-center p-4 bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl">
                        <div class="text-2xl font-bold text-blue-600" id="total-dialogues">24</div>
                        <div class="text-sm text-blue-800">总话术数</div>
                    </div>
                    <div class="text-center p-4 bg-gradient-to-br from-green-50 to-green-100 rounded-xl">
                        <div class="text-2xl font-bold text-green-600" id="active-dialogues">22</div>
                        <div class="text-sm text-green-800">启用话术</div>
                    </div>
                    <div class="text-center p-4 bg-gradient-to-br from-orange-50 to-orange-100 rounded-xl">
                        <div class="text-2xl font-bold text-orange-600" id="avg-conversion">38%</div>
                        <div class="text-sm text-orange-800">平均转化率</div>
                    </div>
                    <div class="text-center p-4 bg-gradient-to-br from-purple-50 to-purple-100 rounded-xl">
                        <div class="text-2xl font-bold text-purple-600" id="last-updated">今天</div>
                        <div class="text-sm text-purple-800">最后更新</div>
                    </div>
                </div>
            </div>

            <!-- Filters -->
            <div class="dialogue-card rounded-2xl p-6 mb-8">
                <h3 class="text-lg font-bold text-gray-900 mb-4">筛选条件</h3>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <!-- Scene Filter -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">应用场景</label>
                        <select id="scene-filter" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="">全部场景</option>
                            <option value="phone">电话外呼</option>
                            <option value="face">语音沟通</option>
                            <option value="online">微信聊天</option>
                        </select>
                    </div>

                    <!-- Category Filter -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">话术分类</label>
                        <select id="category-filter" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="">全部分类</option>
                            <option value="号码认证">号码认证</option>
                            <option value="卡片消息">卡片消息</option>
                            <option value="来电名片">来电名片</option>
                            <option value="挂机短信">挂机短信</option>
                        </select>
                    </div>

                    <!-- Technique Filter -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">心理技巧</label>
                        <select id="technique-filter" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="">全部技巧</option>
                            <option value="limited_time">限时优惠</option>
                            <option value="free_trial">免费试用</option>
                            <option value="competitive_risk">竞争风险</option>
                            <option value="ownership_loss">失去之痛</option>
                        </select>
                    </div>

                    <!-- Status Filter -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">状态</label>
                        <select id="status-filter" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="">全部状态</option>
                            <option value="active">启用</option>
                            <option value="inactive">禁用</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Dialogue List -->
    <section class="px-4 sm:px-6 lg:px-8 mb-20">
        <div class="max-w-7xl mx-auto">
            <div class="dialogue-card rounded-2xl p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-2xl font-bold text-gray-900">话术列表</h3>
                    <div class="flex items-center space-x-2">
                        <button onclick="selectAll()" class="text-sm text-blue-600 hover:text-blue-800">全选</button>
                        <button onclick="deselectAll()" class="text-sm text-gray-600 hover:text-gray-800">取消全选</button>
                        <button onclick="batchDelete()" class="text-sm text-red-600 hover:text-red-800">批量删除</button>
                    </div>
                </div>

                <div id="dialogue-list" class="space-y-4">
                    <!-- Dialogue items will be dynamically generated here -->
                </div>

                <!-- Empty State -->
                <div id="empty-state" class="hidden text-center py-12">
                    <svg class="w-16 h-16 text-gray-400 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                    </svg>
                    <h4 class="text-lg font-semibold text-gray-900 mb-2">暂无话术</h4>
                    <p class="text-gray-600 mb-4">没有找到符合条件的话术，请尝试调整筛选条件</p>
                    <button onclick="clearFilters()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                        清除筛选
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- Edit Modal -->
    <div id="edit-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
        <div class="dialogue-card rounded-2xl p-8 max-w-4xl w-full max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-gray-900">编辑话术</h3>
                <button onclick="closeEditModal()" class="text-gray-500 hover:text-gray-700">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <form id="edit-form" class="space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">场景</label>
                        <select id="edit-scene" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="phone">电话外呼</option>
                            <option value="face">语音沟通</option>
                            <option value="online">微信聊天</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">分类</label>
                        <input type="text" id="edit-category" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="如：号码认证">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">预期转化率</label>
                        <input type="text" id="edit-conversion" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="如：35%">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">心理技巧</label>
                        <select id="edit-technique" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="limited_time">限时优惠与稀缺性</option>
                            <option value="free_trial">免费试用与沉没成本</option>
                            <option value="competitive_risk">竞争风险与现状代价</option>
                            <option value="ownership_loss">已有之物的失去</option>
                            <option value="bundle_loss">打包服务与失去组件</option>
                            <option value="customer_retention">售后跟进与客户维系</option>
                        </select>
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">传统话术</label>
                    <textarea id="edit-traditional" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="输入传统话术..."></textarea>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">损失厌恶话术</label>
                    <textarea id="edit-loss-aversion" rows="4" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="输入损失厌恶话术..."></textarea>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">心理学原理</label>
                    <input type="text" id="edit-psychology" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="如：竞争损失 + 机会成本">
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">使用技巧</label>
                    <textarea id="edit-tips" rows="2" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="输入使用技巧..."></textarea>
                </div>

                <div class="flex items-center">
                    <input type="checkbox" id="edit-status" class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                    <label for="edit-status" class="ml-2 text-sm text-gray-700">启用此话术</label>
                </div>

                <div class="flex justify-end space-x-4 pt-6 border-t">
                    <button type="button" onclick="closeEditModal()" class="cancel-btn px-6 py-2 rounded-lg font-medium transition-all duration-300">
                        取消
                    </button>
                    <button type="button" onclick="saveDialogue()" class="save-btn px-6 py-2 rounded-lg font-medium transition-all duration-300">
                        保存
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Import/Export Modal -->
    <div id="import-export-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
        <div class="dialogue-card rounded-2xl p-8 max-w-2xl w-full">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-gray-900">导入/导出话术</h3>
                <button onclick="closeImportExportModal()" class="text-gray-500 hover:text-gray-700">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <div class="space-y-6">
                <!-- Export Section -->
                <div class="p-4 bg-gray-50 rounded-lg">
                    <h4 class="text-lg font-semibold text-gray-900 mb-3">导出话术</h4>
                    <p class="text-sm text-gray-600 mb-4">将当前话术库导出为JSON文件，方便备份和分享</p>
                    <div class="flex space-x-3">
                        <button onclick="exportAllDialogues()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                            导出全部
                        </button>
                        <button onclick="exportFilteredDialogues()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors">
                            导出筛选结果
                        </button>
                    </div>
                </div>

                <!-- Import Section -->
                <div class="p-4 bg-gray-50 rounded-lg">
                    <h4 class="text-lg font-semibold text-gray-900 mb-3">导入话术</h4>
                    <p class="text-sm text-gray-600 mb-4">从JSON文件导入话术，支持批量添加和更新</p>
                    <div class="space-y-3">
                        <input type="file" id="import-file" accept=".json" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <div class="flex space-x-3">
                            <button onclick="importDialogues()" class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors">
                                导入文件
                            </button>
                            <button onclick="downloadTemplate()" class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-colors">
                                下载模板
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Import Options -->
                <div class="space-y-3">
                    <h5 class="font-medium text-gray-900">导入选项</h5>
                    <div class="space-y-2">
                        <label class="flex items-center">
                            <input type="radio" name="import-mode" value="add" checked class="w-4 h-4 text-blue-600 border-gray-300 focus:ring-blue-500">
                            <span class="ml-2 text-sm text-gray-700">仅添加新话术（跳过已存在的话术）</span>
                        </label>
                        <label class="flex items-center">
                            <input type="radio" name="import-mode" value="update" class="w-4 h-4 text-blue-600 border-gray-300 focus:ring-blue-500">
                            <span class="ml-2 text-sm text-gray-700">更新已存在的话术（根据ID匹配）</span>
                        </label>
                        <label class="flex items-center">
                            <input type="radio" name="import-mode" value="replace" class="w-4 h-4 text-blue-600 border-gray-300 focus:ring-blue-500">
                            <span class="ml-2 text-sm text-gray-700">替换整个话术库（清空现有内容）</span>
                        </label>
                    </div>
                </div>
            </div>

            <div class="flex justify-end space-x-4 pt-6 border-t">
                <button onclick="closeImportExportModal()" class="cancel-btn px-6 py-2 rounded-lg font-medium transition-all duration-300">
                    关闭
                </button>
            </div>
        </div>
    </div>

    <!-- Add Dialogue Modal -->
    <div id="add-dialogue-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
        <div class="dialogue-card rounded-2xl p-8 max-w-4xl w-full max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-gray-900">添加新话术</h3>
                <button onclick="closeAddDialogueModal()" class="text-gray-500 hover:text-gray-700">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <form id="add-form" class="space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">场景 *</label>
                        <select id="add-scene" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="">请选择场景</option>
                            <option value="phone">电话外呼</option>
                            <option value="face">语音沟通</option>
                            <option value="online">微信聊天</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">分类 *</label>
                        <input type="text" id="add-category" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="如：号码认证">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">预期转化率</label>
                        <input type="text" id="add-conversion" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="如：35%">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">心理技巧</label>
                        <select id="add-technique" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="">请选择技巧</option>
                            <option value="limited_time">限时优惠与稀缺性</option>
                            <option value="free_trial">免费试用与沉没成本</option>
                            <option value="competitive_risk">竞争风险与现状代价</option>
                            <option value="ownership_loss">已有之物的失去</option>
                            <option value="bundle_loss">打包服务与失去组件</option>
                            <option value="customer_retention">售后跟进与客户维系</option>
                        </select>
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">传统话术 *</label>
                    <textarea id="add-traditional" required rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="输入传统话术..."></textarea>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">损失厌恶话术 *</label>
                    <textarea id="add-loss-aversion" required rows="4" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="输入损失厌恶话术..."></textarea>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">心理学原理</label>
                    <input type="text" id="add-psychology" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="如：竞争损失 + 机会成本">
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">使用技巧</label>
                    <textarea id="add-tips" rows="2" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="输入使用技巧..."></textarea>
                </div>

                <div class="flex items-center">
                    <input type="checkbox" id="add-status" checked class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                    <label for="add-status" class="ml-2 text-sm text-gray-700">立即启用此话术</label>
                </div>

                <div class="flex justify-end space-x-4 pt-6 border-t">
                    <button type="button" onclick="closeAddDialogueModal()" class="cancel-btn px-6 py-2 rounded-lg font-medium transition-all duration-300">
                        取消
                    </button>
                    <button type="button" onclick="addNewDialogue()" class="save-btn px-6 py-2 rounded-lg font-medium transition-all duration-300">
                        添加话术
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-900 text-white py-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center">
                <div class="flex items-center justify-center space-x-2 mb-4">
                    <div class="w-8 h-8 bg-gradient-to-br from-blue-600 to-orange-500 rounded-lg flex items-center justify-center">
                        <span class="text-white font-bold text-sm">新奥</span>
                    </div>
                    <span class="text-xl font-bold">损失厌恶话术系统</span>
                </div>
                <p class="text-gray-400 mb-4">基于心理学理论的营销沟通工具</p>
                <p class="text-gray-500 text-sm">© 2025 By商呼三部—让每次沟通都更有说服力.</p>
            </div>
        </div>
    </footer>

    <script>
        // Global variables
        let dialogues = [];
        let filteredDialogues = [];
        let currentEditId = null;
        let isEditMode = true;

        // Load dialogues data
        document.addEventListener('DOMContentLoaded', function() {
            loadDialogues();
            setupEventListeners();
            renderDialogueList();
            updateStats();
        });

        function loadDialogues() {
            // Load from localStorage or use default data
            const savedDialogues = localStorage.getItem('dialogues');
            if (savedDialogues) {
                dialogues = JSON.parse(savedDialogues);
            } else {
                // Default dialogues data
                dialogues = [
                    {
                        id: 'phone_01',
                        scene: 'phone',
                        category: '号码认证',
                        traditional: '办理我们的号码认证，您将获得接通率效率提升、企业名称认证，方便快捷办理节省您时间。',
                        loss_aversion: '如果不使用我们的号码认证产品，您的号码将会继续被标记成骚扰销售等情况，眼睁睁看着您的同行凭借号码认证的业务优势抢走您的客户。',
                        psychology: '竞争损失 + 机会成本',
                        tips: '强调客户正在失去的东西，而非获得的东西',
                        conversion: '35%',
                        technique: 'limited_time',
                        status: 'active',
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    },
                    {
                        id: 'phone_02',
                        scene: 'phone',
                        category: '企业服务',
                        traditional: '我们的CRM系统能帮助您提升客户管理效率，增加销售业绩。',
                        loss_aversion: '根据我们的数据分析，您目前的手动管理方式每月让您损失约8000元的潜在收益，一年就是近10万元的业务损失。您的竞争对手已经在使用自动化系统抢占您的市场份额。',
                        psychology: '量化损失 + 竞争威胁',
                        tips: '用具体数字强化损失感知',
                        conversion: '42%',
                        technique: 'competitive_risk',
                        status: 'active',
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    }
                ];
                saveDialogues();
            }
            filteredDialogues = [...dialogues];
        }

        function saveDialogues() {
            localStorage.setItem('dialogues', JSON.stringify(dialogues));
        }

        function setupEventListeners() {
            // Search functionality
            document.getElementById('search-input').addEventListener('input', handleSearch);
            
            // Filter functionality
            document.getElementById('scene-filter').addEventListener('change', applyFilters);
            document.getElementById('category-filter').addEventListener('change', applyFilters);
            document.getElementById('technique-filter').addEventListener('change', applyFilters);
            document.getElementById('status-filter').addEventListener('change', applyFilters);
        }

        function handleSearch() {
            const searchTerm = document.getElementById('search-input').value.toLowerCase();
            
            if (searchTerm === '') {
                filteredDialogues = [...dialogues];
            } else {
                filteredDialogues = dialogues.filter(dialogue => 
                    dialogue.traditional.toLowerCase().includes(searchTerm) ||
                    dialogue.loss_aversion.toLowerCase().includes(searchTerm) ||
                    dialogue.category.toLowerCase().includes(searchTerm) ||
                    dialogue.psychology.toLowerCase().includes(searchTerm)
                );
            }
            
            applyFilters();
        }

        function applyFilters() {
            let filtered = [...filteredDialogues];
            
            // Apply scene filter
            const sceneFilter = document.getElementById('scene-filter').value;
            if (sceneFilter) {
                filtered = filtered.filter(d => d.scene === sceneFilter);
            }
            
            // Apply category filter
            const categoryFilter = document.getElementById('category-filter').value;
            if (categoryFilter) {
                filtered = filtered.filter(d => d.category === categoryFilter);
            }
            
            // Apply technique filter
            const techniqueFilter = document.getElementById('technique-filter').value;
            if (techniqueFilter) {
                filtered = filtered.filter(d => d.technique === techniqueFilter);
            }
            
            // Apply status filter
            const statusFilter = document.getElementById('status-filter').value;
            if (statusFilter) {
                filtered = filtered.filter(d => d.status === statusFilter);
            }
            
            filteredDialogues = filtered;
            renderDialogueList();
        }

        function renderDialogueList() {
            const container = document.getElementById('dialogue-list');
            const emptyState = document.getElementById('empty-state');
            
            if (filteredDialogues.length === 0) {
                container.innerHTML = '';
                emptyState.classList.remove('hidden');
                return;
            }
            
            emptyState.classList.add('hidden');
            
            container.innerHTML = filteredDialogues.map(dialogue => `
                <div class="dialogue-item border border-gray-200 rounded-lg p-6 ${dialogue.status === 'inactive' ? 'opacity-60' : ''}">
                    <div class="flex justify-between items-start mb-4">
                        <div class="flex items-center space-x-3">
                            <input type="checkbox" class="dialogue-checkbox w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500" value="${dialogue.id}">
                            <div class="flex items-center space-x-2">
                                <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-xs font-medium">${getSceneName(dialogue.scene)}</span>
                                <span class="bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs font-medium">${dialogue.category}</span>
                                <span class="bg-orange-100 text-orange-800 px-2 py-1 rounded-full text-xs font-medium">转化率: ${dialogue.conversion}</span>
                                ${dialogue.status === 'inactive' ? '<span class="bg-gray-100 text-gray-800 px-2 py-1 rounded-full text-xs font-medium">已禁用</span>' : ''}
                            </div>
                        </div>
                        <div class="flex items-center space-x-2">
                            <button onclick="editDialogue('${dialogue.id}')" class="text-blue-600 hover:text-blue-800 p-2">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                </svg>
                            </button>
                            <button onclick="toggleDialogueStatus('${dialogue.id}')" class="text-gray-600 hover:text-gray-800 p-2">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    ${dialogue.status === 'active' ? 
                                        '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>' :
                                        '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h1.586a1 1 0 01.707.293l2.414 2.414a1 1 0 00.707.293H15M9 10V9a2 2 0 012-2h2a2 2 0 012 2v1M9 10v5a2 2 0 002 2h2a2 2 0 002-2v-5"></path>'
                                    }
                                </svg>
                            </button>
                            <button onclick="deleteDialogue('${dialogue.id}')" class="text-red-600 hover:text-red-800 p-2">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                </svg>
                            </button>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div>
                            <h4 class="text-sm font-medium text-gray-700 mb-2 flex items-center">
                                <span class="w-5 h-5 bg-gray-400 rounded-full flex items-center justify-center text-white text-xs mr-2">传</span>
                                传统话术
                            </h4>
                            <div class="traditional-text p-3 bg-gray-50 rounded-lg text-sm">
                                ${highlightSearchTerm(dialogue.traditional)}
                            </div>
                        </div>
                        
                        <div>
                            <h4 class="text-sm font-medium text-gray-700 mb-2 flex items-center">
                                <span class="w-5 h-5 bg-orange-500 rounded-full flex items-center justify-center text-white text-xs mr-2">损</span>
                                损失厌恶话术
                            </h4>
                            <div class="loss-aversion-text p-3 bg-orange-50 rounded-lg text-sm">
                                ${highlightSearchTerm(dialogue.loss_aversion)}
                            </div>
                        </div>
                    </div>

                    <div class="mt-4 flex items-center justify-between text-sm text-gray-600">
                        <div>
                            <strong>心理学原理:</strong> ${dialogue.psychology}
                        </div>
                        <div>
                            最后更新: ${new Date(dialogue.updatedAt).toLocaleDateString()}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function highlightSearchTerm(text) {
            const searchTerm = document.getElementById('search-input').value.toLowerCase();
            if (!searchTerm) return text;
            
            const regex = new RegExp(`(${searchTerm})`, 'gi');
            return text.replace(regex, '<span class="search-highlight">$1</span>');
        }

        function updateStats() {
            const totalDialogues = dialogues.length;
            const activeDialogues = dialogues.filter(d => d.status === 'active').length;
            const avgConversion = dialogues.length > 0 ? 
                Math.round(dialogues.reduce((sum, d) => sum + parseInt(d.conversion), 0) / dialogues.length) : 0;
            
            document.getElementById('total-dialogues').textContent = totalDialogues;
            document.getElementById('active-dialogues').textContent = activeDialogues;
            document.getElementById('avg-conversion').textContent = avgConversion + '%';
        }

        function getSceneName(scene) {
            const sceneNames = {
                'phone': '电话外呼',
                'face': '语音沟通',
                'online': '微信聊天'
            };
            return sceneNames[scene] || scene;
        }

        // Edit mode functions
        function toggleEditMode() {
            isEditMode = true;
            document.getElementById('edit-mode-btn').className = 'edit-mode px-4 py-2 rounded-lg font-medium transition-all duration-300';
            document.getElementById('preview-mode-btn').className = 'px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-medium transition-all duration-300';
        }

        function togglePreviewMode() {
            isEditMode = false;
            document.getElementById('preview-mode-btn').className = 'preview-mode px-4 py-2 rounded-lg font-medium transition-all duration-300';
            document.getElementById('edit-mode-btn').className = 'px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-medium transition-all duration-300';
        }

        // Dialogue management functions
        function editDialogue(id) {
            const dialogue = dialogues.find(d => d.id === id);
            if (!dialogue) return;
            
            currentEditId = id;
            
            // Populate form
            document.getElementById('edit-scene').value = dialogue.scene;
            document.getElementById('edit-category').value = dialogue.category;
            document.getElementById('edit-conversion').value = dialogue.conversion;
            document.getElementById('edit-technique').value = dialogue.technique;
            document.getElementById('edit-traditional').value = dialogue.traditional;
            document.getElementById('edit-loss-aversion').value = dialogue.loss_aversion;
            document.getElementById('edit-psychology').value = dialogue.psychology;
            document.getElementById('edit-tips').value = dialogue.tips;
            document.getElementById('edit-status').checked = dialogue.status === 'active';
            
            // Show modal
            document.getElementById('edit-modal').classList.remove('hidden');
        }

        function saveDialogue() {
            if (!currentEditId) return;
            
            const dialogue = dialogues.find(d => d.id === currentEditId);
            if (!dialogue) return;
            
            // Update dialogue
            dialogue.scene = document.getElementById('edit-scene').value;
            dialogue.category = document.getElementById('edit-category').value;
            dialogue.conversion = document.getElementById('edit-conversion').value;
            dialogue.technique = document.getElementById('edit-technique').value;
            dialogue.traditional = document.getElementById('edit-traditional').value;
            dialogue.loss_aversion = document.getElementById('edit-loss-aversion').value;
            dialogue.psychology = document.getElementById('edit-psychology').value;
            dialogue.tips = document.getElementById('edit-tips').value;
            dialogue.status = document.getElementById('edit-status').checked ? 'active' : 'inactive';
            dialogue.updatedAt = new Date().toISOString();
            
            saveDialogues();
            applyFilters();
            updateStats();
            closeEditModal();
            
            // Show success message
            showNotification('话术已保存成功！', 'success');
        }

        function toggleDialogueStatus(id) {
            const dialogue = dialogues.find(d => d.id === id);
            if (!dialogue) return;
            
            dialogue.status = dialogue.status === 'active' ? 'inactive' : 'active';
            dialogue.updatedAt = new Date().toISOString();
            
            saveDialogues();
            applyFilters();
            updateStats();
            
            showNotification(`话术已${dialogue.status === 'active' ? '启用' : '禁用'}！`, 'success');
        }

        function deleteDialogue(id) {
            if (!confirm('确定要删除这个话术吗？此操作不可撤销。')) return;
            
            dialogues = dialogues.filter(d => d.id !== id);
            saveDialogues();
            applyFilters();
            updateStats();
            
            showNotification('话术已删除！', 'success');
        }

        // Add new dialogue functions
        function showAddDialogueModal() {
            // Reset form
            document.getElementById('add-form').reset();
            document.getElementById('add-dialogue-modal').classList.remove('hidden');
        }

        function addNewDialogue() {
            const form = document.getElementById('add-form');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }
            
            const newDialogue = {
                id: 'custom_' + Date.now(),
                scene: document.getElementById('add-scene').value,
                category: document.getElementById('add-category').value,
                conversion: document.getElementById('add-conversion').value || '0%',
                technique: document.getElementById('add-technique').value || '',
                traditional: document.getElementById('add-traditional').value,
                loss_aversion: document.getElementById('add-loss-aversion').value,
                psychology: document.getElementById('add-psychology').value || '',
                tips: document.getElementById('add-tips').value || '',
                status: document.getElementById('add-status').checked ? 'active' : 'inactive',
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };
            
            dialogues.push(newDialogue);
            saveDialogues();
            applyFilters();
            updateStats();
            closeAddDialogueModal();
            
            showNotification('新话术已添加成功！', 'success');
        }

        // Import/Export functions
        function showImportExportModal() {
            document.getElementById('import-export-modal').classList.remove('hidden');
        }

        function exportAllDialogues() {
            const dataStr = JSON.stringify(dialogues, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `dialogues_export_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            URL.revokeObjectURL(url);
            
            showNotification('话术已导出成功！', 'success');
        }

        function exportFilteredDialogues() {
            const dataStr = JSON.stringify(filteredDialogues, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `dialogues_filtered_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            URL.revokeObjectURL(url);
            
            showNotification('筛选结果已导出成功！', 'success');
        }

        function downloadTemplate() {
            const template = [
                {
                    id: "example_001",
                    scene: "phone",
                    category: "示例分类",
                    traditional: "这是传统话术的示例",
                    loss_aversion: "这是损失厌恶话术的示例",
                    psychology: "心理学原理说明",
                    tips: "使用技巧提示",
                    conversion: "35%",
                    technique: "limited_time",
                    status: "active"
                }
            ];
            
            const dataStr = JSON.stringify(template, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'dialogue_template.json';
            link.click();
            URL.revokeObjectURL(url);
        }

        function importDialogues() {
            const fileInput = document.getElementById('import-file');
            const file = fileInput.files[0];
            
            if (!file) {
                showNotification('请选择要导入的文件！', 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedDialogues = JSON.parse(e.target.result);
                    const importMode = document.querySelector('input[name="import-mode"]:checked').value;
                    
                    let importedCount = 0;
                    let updatedCount = 0;
                    let skippedCount = 0;
                    
                    importedDialogues.forEach(newDialogue => {
                        const existingIndex = dialogues.findIndex(d => d.id === newDialogue.id);
                        
                        if (existingIndex === -1) {
                            // New dialogue
                            newDialogue.createdAt = new Date().toISOString();
                            newDialogue.updatedAt = new Date().toISOString();
                            dialogues.push(newDialogue);
                            importedCount++;
                        } else if (importMode === 'update') {
                            // Update existing
                            newDialogue.updatedAt = new Date().toISOString();
                            newDialogue.createdAt = dialogues[existingIndex].createdAt;
                            dialogues[existingIndex] = newDialogue;
                            updatedCount++;
                        } else if (importMode === 'replace') {
                            // Will be handled below
                        } else {
                            skippedCount++;
                        }
                    });
                    
                    if (importMode === 'replace') {
                        dialogues = importedDialogues.map(d => ({
                            ...d,
                            createdAt: d.createdAt || new Date().toISOString(),
                            updatedAt: new Date().toISOString()
                        }));
                        importedCount = importedDialogues.length;
                    }
                    
                    saveDialogues();
                    applyFilters();
                    updateStats();
                    
                    showNotification(`导入完成！新增：${importedCount}，更新：${updatedCount}，跳过：${skippedCount}`, 'success');
                    closeImportExportModal();
                    
                } catch (error) {
                    showNotification('文件格式错误，请检查JSON格式！', 'error');
                }
            };
            reader.readAsText(file);
        }

        // Batch operations
        function selectAll() {
            document.querySelectorAll('.dialogue-checkbox').forEach(checkbox => {
                checkbox.checked = true;
            });
        }

        function deselectAll() {
            document.querySelectorAll('.dialogue-checkbox').forEach(checkbox => {
                checkbox.checked = false;
            });
        }

        function batchDelete() {
            const selectedIds = Array.from(document.querySelectorAll('.dialogue-checkbox:checked')).map(cb => cb.value);
            
            if (selectedIds.length === 0) {
                showNotification('请先选择要删除的话术！', 'error');
                return;
            }
            
            if (!confirm(`确定要删除选中的 ${selectedIds.length} 个话术吗？此操作不可撤销。`)) return;
            
            dialogues = dialogues.filter(d => !selectedIds.includes(d.id));
            saveDialogues();
            applyFilters();
            updateStats();
            
            showNotification(`已删除 ${selectedIds.length} 个话术！`, 'success');
        }

        function clearFilters() {
            document.getElementById('search-input').value = '';
            document.getElementById('scene-filter').value = '';
            document.getElementById('category-filter').value = '';
            document.getElementById('technique-filter').value = '';
            document.getElementById('status-filter').value = '';
            
            filteredDialogues = [...dialogues];
            renderDialogueList();
        }

        // Modal functions
        function closeEditModal() {
            document.getElementById('edit-modal').classList.add('hidden');
            currentEditId = null;
        }

        function closeImportExportModal() {
            document.getElementById('import-export-modal').classList.add('hidden');
            document.getElementById('import-file').value = '';
        }

        function closeAddDialogueModal() {
            document.getElementById('add-dialogue-modal').classList.add('hidden');
        }

        // Utility functions
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 z-50 px-6 py-3 rounded-lg text-white font-medium transition-all duration-300 transform translate-x-full`;
            
            if (type === 'success') {
                notification.classList.add('bg-green-600');
            } else if (type === 'error') {
                notification.classList.add('bg-red-600');
            } else {
                notification.classList.add('bg-blue-600');
            }
            
            notification.textContent = message;
            document.body.appendChild(notification);
            
            // Animate in
            setTimeout(() => {
                notification.classList.remove('translate-x-full');
            }, 100);
            
            // Animate out and remove
            setTimeout(() => {
                notification.classList.add('translate-x-full');
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }

        // Scroll animations
        const observerOptions = {
            threshold: 0.1,
            rootMargin: '0px 0px -50px 0px'
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    anime({
                        targets: entry.target,
                        translateY: [50, 0],
                        opacity: [0, 1],
                        duration: 800,
                        easing: 'easeOutQuad'
                    });
                }
            });
        }, observerOptions);

        // Observe all cards
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.dialogue-card').forEach(card => {
                observer.observe(card);
            });
        });
    </script>
</body>
</html>
